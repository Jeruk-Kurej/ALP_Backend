// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client" 
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int     @id @default(autoincrement())
  username  String  @db.VarChar(150)
  email     String  @unique @db.VarChar(150)
  password  String  @db.VarChar(255) 
  is_active Boolean @default(true)

  // Relasi 1:M - User bisa punya banyak toko
  tokos     Toko[]

  @@map("user")
}

model Toko {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(150)
  description String? @db.Text
  is_open     Boolean @default(true)
  location    String? @db.Text
  image       String? @db.Text 

  // Foreign Key - setiap toko punya 1 owner
  owner_id    Int

  // Relasi - Toko belongs to User (owner)
  owner       User    @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  // Relasi lain
  orders       Order[]
  tokoProducts TokoProduct[]

  @@index([owner_id])
  @@map("toko")
}

model Product {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(150)
  description String? @db.Text
  price       Decimal @db.Decimal(12, 2)
  image       String? @db.Text

  // Foreign Key
  category_id Int

  // Relasi
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  // Relasi lain
  tokoProducts TokoProduct[]
  orderItems   OrderItem[]

  @@index([category_id])
  @@map("product")
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String    @unique @db.VarChar(100)
  
  // Relasi
  products Product[]

  @@map("category")
}

model TokoProduct {
  id         Int @id @default(autoincrement())
  
  // Foreign Keys
  toko_id    Int
  product_id Int
  
  // Relasi
  toko       Toko    @relation(fields: [toko_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([toko_id])
  @@index([product_id])
  @@map("toko_product")
}

model Order {
  id            Int      @id @default(autoincrement())
  create_date   DateTime @default(now())
  customer_name String   @db.VarChar(150)
  
  // Foreign Keys
  toko_id       Int
  payment_id    Int
  
  // Relasi
  toko          Toko    @relation(fields: [toko_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  payment       Payment @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  orderItems    OrderItem[]

  @@index([toko_id])
  @@index([payment_id])
  @@map("order")
}

model Payment {
  id     Int     @id @default(autoincrement())
  name   String  @unique @db.VarChar(50)
  
  // Relasi
  orders Order[]

  @@map("payment")
}

model OrderItem {
  id           Int @id @default(autoincrement())
  order_amount Int
  
  // Foreign Keys
  product_id   Int
  order_id     Int
  
  // Relasi
  product      Product @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  order        Order   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([product_id])
  @@index([order_id])
  @@map("order_item")
}