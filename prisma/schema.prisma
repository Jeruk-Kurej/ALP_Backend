generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int        @id @default(autoincrement())
  username   String     @db.VarChar(150)
  email      String     @unique @db.VarChar(150)
  password   String     @db.VarChar(255)
  is_active  Boolean    @default(true)
  categories Category[]
  tokos      Toko[]

  @@map("user")
}

model Toko {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(150)
  description  String?
  is_open      Boolean       @default(true)
  location     String?
  image        String?
  owner_id     Int
  orders       Order[]
  owner        User          @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  tokoProducts TokoProduct[]

  @@index([owner_id])
  @@map("toko")
}

model Product {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(150)
  description  String?
  price        Decimal       @db.Decimal(12, 2)
  image        String?
  category_id  Int
  orderItems   OrderItem[]
  category     Category      @relation(fields: [category_id], references: [id], onDelete: Cascade)
  tokoProducts TokoProduct[]

  @@index([category_id])
  @@map("product")
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String    @db.VarChar(100)
  owner_id Int
  owner    User      @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  products Product[]

  @@unique([name, owner_id])
  @@index([owner_id])
  @@map("category")
}

model TokoProduct {
  id         Int     @id @default(autoincrement())
  toko_id    Int
  product_id Int
  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  toko       Toko    @relation(fields: [toko_id], references: [id], onDelete: Cascade)

  @@index([toko_id])
  @@index([product_id])
  @@map("toko_product")
}

model Order {
  id            Int         @id @default(autoincrement())
  create_date   DateTime    @default(now())
  customer_name String      @db.VarChar(150)
  toko_id       Int
  payment_id    Int
  status        String      @default("pending") @db.VarChar(50)
  payment       Payment     @relation(fields: [payment_id], references: [id], onDelete: Cascade)
  toko          Toko        @relation(fields: [toko_id], references: [id], onDelete: Cascade)
  orderItems    OrderItem[]

  @@index([toko_id])
  @@index([payment_id])
  @@map("order")
}

model Payment {
  id     Int     @id @default(autoincrement())
  name   String  @unique @db.VarChar(50)
  orders Order[]

  @@map("payment")
}

model OrderItem {
  id           Int     @id @default(autoincrement())
  order_amount Int
  product_id   Int
  order_id     Int
  order        Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product      Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([product_id])
  @@index([order_id])
  @@map("order_item")
}
